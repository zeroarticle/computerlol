<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Счётчик и чат</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    color: #fff;
    background:
      radial-gradient(circle at 20% 20%, #ffd54f 2px, transparent 3px),
      radial-gradient(circle at 80% 30%, #ff7043 2px, transparent 3px),
      radial-gradient(circle at 50% 70%, #4fc3f7 2px, transparent 3px),
      linear-gradient(135deg, #7b2ff7, #3a7bd5);
    background-size: 120px 120px, 160px 160px, 200px 200px, cover;
    animation: bgMove 20s linear infinite;
  }
  @keyframes bgMove {
    0% { background-position: 0 0, 0 0, 0 0, 0 0; }
    100% { background-position: 200px 200px, -200px 100px, 150px -150px, 0 0; }
  }
  .note { color: #ffeb3b; margin-bottom: 20px; font-size: 18px; }
  .card { background: rgba(0,0,0,0.35); border-radius: 18px; padding: 20px; margin: 18px auto; max-width: 420px; box-shadow: 0 0 20px rgba(0,0,0,0.4); animation: pulse 2.5s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.015);} }
  .best { border:2px solid #4caf50; }
  .worst { border:2px solid #f44336; }
  .time { font-size:26px; }
  .percent { margin-bottom:8px; }
  .bar { height:14px; background:rgba(255,255,255,0.2); border-radius:10px; overflow:hidden; }
  .fill { height:100%; width:0%; transition: width 0.6s ease; }
  .fill.best { background: linear-gradient(90deg, #4caf50, #8bc34a); }
  .fill.worst { background: linear-gradient(90deg, #f44336, #ff9800); }
  .comments { background: rgba(0,0,0,0.4); border-radius: 18px; padding: 20px; max-width: 420px; margin: 30px auto; }
  input, textarea, button { width: 100%; margin: 6px 0; padding: 8px; border-radius: 8px; border: none; font-size: 14px; }
  button { background: #ffeb3b; cursor: pointer; }
  .comment { text-align: left; background: rgba(255,255,255,0.1); padding: 8px; margin-top: 6px; border-radius: 8px; font-size: 14px; }
</style>
</head>
<body>

<h2>Счётчик времени</h2>
<div class="note">Это счётчик до сборки компьютера</div>

<div class="card best">
  <div>Лучший случай (13:00)</div>
  <div class="time" id="timerBest"></div>
  <div class="percent" id="percentBest"></div>
  <div class="bar"><div class="fill best" id="barBest"></div></div>
</div>

<div class="card worst">
  <div>Худший случай (17:00)</div>
  <div class="time" id="timerWorst"></div>
  <div class="percent" id="percentWorst"></div>
  <div class="bar"><div class="fill worst" id="barWorst"></div></div>
</div>

<div class="comments">
  <h3>Комментарии</h3>
  <p>Лимит: имя - 15 символов, комментарий - 100 символов.</p>
  <input id="name" placeholder="Имя" maxlength="15">
  <textarea id="text" placeholder="Комментарий" maxlength="100"></textarea>
  <button onclick="sendComment()">Отправить</button>
  <div id="list"></div>
</div>

<!-- ===== FIREBASE REALTIME DATABASE ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } 
from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyDbAvcfYcB4aQ9xp9-TtefPZ_ibOyGCDiY",
    authDomain: "zsuero-bot.firebaseapp.com",
    databaseURL: "https://zsuero-bot-default-rtdb.firebaseio.com",
    projectId: "zsuero-bot"
  };

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const commentsRef = ref(db, "comments");

// Отправка комментария
window.sendComment = () => {
  const name = document.getElementById("name").value.trim();
  const text = document.getElementById("text").value.trim();
  if(!name || !text) return;
  push(commentsRef, {name, text, time: Date.now()});
  document.getElementById("text").value = "";
};

// Получение всех комментариев в реальном времени
onChildAdded(commentsRef, snapshot => {
  const c = snapshot.val();
  const list = document.getElementById("list");
  const div = document.createElement("div");
  div.className = "comment";
  div.innerHTML = `<b>${c.name}:</b> ${c.text}`;
  list.appendChild(div);
  list.scrollTop = list.scrollHeight;
});
</script>

<!-- ===== ТАЙМЕР ===== -->
<script>
const totalDuration = 99960 * 1000;
const bestEnd = new Date("2025-12-27T13:00:00").getTime();
const worstEnd = new Date("2025-12-27T17:00:00").getTime();
const bestStart = bestEnd - totalDuration;
const worstStart = worstEnd - totalDuration;

function format(ms){
  if(ms <= 0) return "Готово";
  const d = Math.floor(ms/86400000);
  const h = Math.floor(ms/3600000)%24;
  const m = Math.floor(ms/60000)%60;
  const s = Math.floor(ms/1000)%60;
  return `${d}д ${h}ч ${m}м ${s}с`;
}

function percent(now, start, end){
  return Math.min(100, Math.max(0, ((now-start)/(end-start))*100));
}

function update(){
  const now = Date.now();
  const pB = percent(now,bestStart,bestEnd);
  const pW = percent(now,worstStart,worstEnd);
  timerBest.textContent = format(bestEnd-now);
  percentBest.textContent = `Прогресс: ${pB.toFixed(6)}%`;
  barBest.style.width = pB+"%";
  timerWorst.textContent = format(worstEnd-now);
  percentWorst.textContent = `Прогресс: ${pW.toFixed(6)}%`;
  barWorst.style.width = pW+"%";
}
update();
setInterval(update,1000);
</script>

</body>
</html>
